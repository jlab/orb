params {
    reads = "/vol/jlab/tlin/all_project/sample_sheets/rna1_samplesheet_stranded_subset_assemblers.csv"
    input = "/vol/jlab/tlin/all_project/sample_sheets/contig_sheet.csv"
    outdir = "test"

}

process {
    executor = 'slurm'
    queue = 'chaos'
    cpus = 32
    memory = '32G'
    queueSize = 300
    time = '20h'
    errorStrategy = { task.attempt <= 2 ? 'retry' : 'finish' }
    maxRetries = 2
    clusterOptions = '--ntasks-per-node=1 --exclude=rs700-bcf-4.intra,rs500-bcf-10.intra,rs500-bcf-05.intra,rs500-bcf-07.intra'

    beforeScript = """
        var=/var/scratch/\$USER/process_tmp_\$(date +%s%N)\$RANDOM
        echo $USER >> log.txt
        echo \$var > podman_dir.txt
        mkdir -p \$var/podman
        #podman system reset -f
        #podman system migrate
        export XDG_RUNTIME_DIR=\$var/podman
        export TMPDIR=\$var
        export http_proxy=http://192.168.10.1:3128
        export https_proxy=http://192.168.10.1:3128
        export ftp_proxy=http://192.168.10.1:3128
    """

     afterScript = """
        var=\$(cat podman_dir.txt)
        echo \$var
        rm -rf \$var
    """


    withName: SALMON_QUANT {
        memory = '32G'
        cpus = 32
    }
}

podman {
    runOptions = '--group-add keep-groups'
}
